<!DOCTYPE html>
<html>
  <head>
    <title>Lorca App</title>
    <link rel="shortcut icon" href="favicon.png" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <h1 id="textField"></h1>
    <a href="settings.html">Go here</a>
    <div class="graph">
      <ul class="week"></ul>
      <ul class="age"></ul>
      <ul class="squares"></ul>
    </div>
    <div id="myModal" class="modal">
      <div class="modal-content">
        <p>Enter date of birth</p>
        <form id="myForm">
          <input name="dob" type="date" placeholder="Enter date of birth" />
          <input type="submit" value="Submit" />
        </form>
      </div>
    </div>
    <script>
      let modal = document.getElementById("myModal");
      const initCheck = async () => {
        try {
          let isSet = await isUserSet();
          if (isSet) {
            setScreen();
          } else {
            modal.style.display = "block";
          }
          console.log(isSet);
          return isSet;
        } catch (e) {
          console.error(e);
        }
      };
      (async () => {
        try {
          let userName = await getUserName();
          document.getElementById("textField").innerText = `Hello, ${userName}`;
        } catch (e) {
          console.error(e);
        }
      })();
      initCheck();
      let dob;
      const form = document.getElementById("myForm");
      form.addEventListener("submit", async (event) => {
        event.preventDefault();
        console.log("Test mmeeeee", event);
        modal.style.display = "none";
        console.log(form["dob"].value);
        let record = await getSettings();
        await updateDOB(record.Name, form["dob"].value, record.Colors);
        setScreen();
      });
      const setScreen = async () => {
        try {
          let weeks = await getWeeksDone();
          console.log(weeks);
          const squares = document.querySelector(".squares");
          for (var i = 0; i < weeks; i++) {
            squares.insertAdjacentHTML(
              "beforeend",
              `<li data-level="done"></li>`
            );
          }
          for (var i = 0; i < 4680 - weeks; i++) {
            squares.insertAdjacentHTML(
              "beforeend",
              `<li data-level="incomplete"></li>`
            );
          }
        } catch (e) {
          console.error(e);
        }
      };
      const weeks = document.querySelector(".week");
      for (var i = 1; i <= 52; i++) {
        weeks.insertAdjacentHTML("beforeend", `<li>${i}</li>`);
      }
      const ages = document.querySelector(".age");
      for (var i = 0; i < 90; i++) {
        ages.insertAdjacentHTML("beforeend", `<li>${i}</li>`);
      }
    </script>
  </body>
</html>
